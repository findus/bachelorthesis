\section{Einsatz von Entwurfsmustern}

\begin{quotation}
"`Entwurfsmuster sind Lösungswissen für allgemeine bzw. immer wiederkehrende Probleme [\ldots]. Ein Entwurfsmuster
besteht aus wenigen Klassen, die durch den Einsatz von Delegation und Vererbung eine robuste und modifizierbare Lösung
ermöglichen."' \cite[S. 719]{Bruegge_2004}
\end{quotation}

In Folgenden werden einige Komponenten von Cydonia vorgestellt und es wird erläutert, wie bei ihrer Entwicklung
Entwurfsmuster zum Einsatz kommen.


\subsection{Equipment-Erzeugung mittels Abstrakte-Fabrik-Muster}
Da die Equipments der Spieler unterschiedlich sein können und auch in der Zukunft erweiterbar sein sollen, werden sie
von einer Fabrik-Klasse erzeugt. Die Equipments müssen in Client und Server jedoch unterschiedliche Implementierungen
haben. Im Client soll das Equipment grafisch dargestellt und Sounds abgespielt werden. Im Server dagegen sollen
stattdessen die Auswirkungen der Benutzung berechnet werden. Daher kommt hier das Abstrakte-Fabrik-Muster zum Einsatz.
"`Das Abstrakte-Fabrik-Muster setzt Spezifikationsvererbung ein, um die Schnittstelle eines Produkts von seiner
Implementierung zu entkoppeln."'\cite[S. 360]{Bruegge_2004} Um sicherzustellen, dass auf jeder Plattform stets nur die
richtigen Objekte erzeugt werden, also eine konsistente Menge von Objekten vorhanden ist, dürfen Objekte nur über eine
Fabrik erzeugt werden.\cite[S. 360]{Bruegge_2004} Im Fall der Equipments existieren eine ClientEquipmentFactory und eine
ServerEquipmentFactory, die jeweils die von AbstractEquipmentFactory geerbten Methoden zur Erzeugung von Pick'n'Place-
und Swapper-Equipments implementieren. Abbildung \ref{figure:equipment_factory} zeigt die Struktur als
UML-Klassendiagramm.

\begin{figure}[htbp]
\centering
\includegraphics[width=1.0\textwidth]{images/equipment_factory}
\caption[UML-Klassendiagramm: Equipment-Factory]{UML-Klassendiagramm: Equipment-Factory}
\label{figure:equipment_factory}
\end{figure}


\subsection{Szenen-Graph-Erstellung mithilfe des Kompositionsmusters}
\label{subsection:SceneGraph_CompositePattern}
Das Kompositionsmuster ist eine Lösung, um eine Hierarchie beliebiger Breite und Tiefe zu repräsentieren, sodass sowohl
einzelne Objekte als auch Kompositionen von Objekten durch eine gemeinsame Schnittstelle einheitlich behandelt werden
können.\cite[S. 724]{Bruegge_2004} Abbildung \ref{figure:composition_spatial} zeigt die Nutzung des Kompositionsmusters
zur Implementierung des Szenen-Graphen in der jMonkeyEngine3. Die Komponente heißt hier Spatial. Geometry, die
Blatt-Klasse, stellt ein tatsächliches Objekt in der virtuellen Welt dar, definiert durch Formen und Materialien. Das
Kompositum ist Node, welches wiederum andere Spatials als Kindelemente enthalten kann.\par

\begin{figure}[htbp]
\centering
\includegraphics[width=0.6\textwidth]{images/composition_spatial}
\caption[UML-Klassendiagramm: Implementierung Szenen-Graph der jME3]{UML-Klassendiagramm: Implementierung des Szenen-Graph der jME3 unter Verwendung des Kompositionsmusters}
\label{figure:composition_spatial}
\end{figure}

Ein Beispiel für die Zusammensetzung der virtuellen Welt aus Spatials kann anhand des Avatars eines Spielers gegeben
werden. Abbildung \ref{figure:composition_avatar} veranschaulicht die Struktur der Spielfigur. Der Wurzelknoten hat drei
Kind\-ele\-men\-te: Kopf, Oberkörper, Unterkörper. Der Kopf ist vom Typ Geometry, während Ober- und Unterkörper Nodes sind,
die wiederum Kindelemente besitzen, nämlich Arme, Beine und Torso. Die Unterteilung könnte natürlich auch noch weiter
gehen: Ein Arm könnte zum Beispiel wiederum ein Knoten sein, der aus Oberarm, Unterarm und Hand besteht, wobei die Hand
ebenfalls aus einzelnen Fingern bestehen könnte usw. Beliebig feingliedrige Strukturen sind möglich, je nach gewünschtem
Detailgrad der Modelle.

\begin{figure}[htbp]
\centering
\includegraphics[width=1.0\textwidth]{images/composition_avatar}
\caption[UML-Objektdiagramm: Aufbau des Spieler-Modells]{UML-Objektdiagramm: Aufbau des Spieler-Modells}
\label{figure:composition_avatar}
\end{figure}


\subsection{Event-System mit Beobachtermuster}
Viele Prozesse in Cydonia werden vom Auftreten eines bestimmten Ereignisses angestoßen. Um diese Ereignisse zu
verteilen, gibt es eine zentrale Ereignis-Maschine, die das Beobachtermuster implementiert.\cite[S. 726]{Bruegge_2004}
Objekte, die über das Auftreten neuer Ereignisse informiert werden wollen, registrieren sich als Beobachter bei der
Ereignis-Maschine. Außerdem stellt sie eine Methode zum Auslösen von Ereignissen in Form von Objekten des Typs Event
(oder eines Subtyps) zur Verfügung. Die Ereignisse werden an jeden Beobachter in einem eigenen Thread weitergereicht,
sodass die Bearbeitung parallel stattfinden kann und eine aufwändigere Bearbeitung nicht die Weiterleitung des
Ereignisses an andere Beobachter verzögert. Abbildung \ref{figure:event_system} stellt das Ereignis-System als
UML-Klassendiagramm dar.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.8\textwidth]{images/event_system}
\caption[UML-Klassendiagramm: Das Ereignis-System]{UML-Klassendiagramm: Das Ereignis-System}
\label{figure:event_system}
\end{figure}


\subsection{Zustandsabhängige Logik mittels Zustandsmuster}
Die Client-Instanz des Spiels steuert gewisse Abläufe in Abhängigkeit ihres aktuellen Zustands. Zum Beispiel dürfen
Mausbewegungen und -klicks nicht in Bewegungen und Aktionen des Avatars umgesetzt werden, solange das Menü offen ist, da
der Spieler sonst unkontrollierte Handlungen in der Spielwelt vollzieht. Um zu verhindern, dass zustandsabhängige Logik
über den gesamten Programmcode verteilt implementiert wird, kommt das Zustandsmuster zum Einsatz. "`Ziel des
Zustandsmusters ist es, die zustandsabhängige Logik auf Klassen zu verteilen, die den jeweiligen Zustand des Systems
repräsentieren."'\cite[229]{Metsker_2006} Vereinfacht dargestellt kann das Spiel zwei Zustände ("`Running"' oder "`Menu"')
haben, die sich in der Reaktion auf Benutzereingaben und den dargestellten Interfaces (Menü, HUD, Nachrichten, etc.)
unterscheiden. Abbildung \ref{figure:states_simple} zeigt die Verwendung des Zustandsmusters in Cydonia in Form eines
UML-Klassendiagramms.

\begin{figure}[htbp]
\centering
\includegraphics[width=1.0\textwidth]{images/states_simple}
\caption[UML-Klassendiagramm: Zustände des Spiels]{UML-Klassendiagramm: Zustände des Spiels}
\label{figure:states_simple}
\end{figure}